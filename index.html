<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¶ ë‚˜ì˜ ê°•ì•„ì§€</title>
<style>
:root{
  --bg:#f5f8ff;--panel:#fff;--border:#d0d8ff;
  --accent:#6b7cff;--danger:#ff6b6b;--good:#6dd58c
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:linear-gradient(180deg,#eef2ff,#fff)}
.hidden{display:none}
.wrap{max-width:900px;margin:auto;padding:16px}
.panel{background:#fff;border-radius:20px;padding:18px;box-shadow:0 20px 40px rgba(0,0,0,.1)}
button{border:none;border-radius:14px;padding:14px;font-weight:700}
.primary{background:var(--accent);color:#fff}
.grid{display:grid;gap:12px}
.grid-3{grid-template-columns:repeat(3,1fr)}
.dog{font-size:130px;text-align:center}
.bar{height:12px;background:#e5e9ff;border-radius:999px;overflow:hidden}
.bar i{display:block;height:100%;background:linear-gradient(90deg,var(--good),#9af0b7)}
.danger{background:linear-gradient(90deg,var(--danger),#ffb3b3)!important}
.bottom{position:fixed;bottom:0;left:0;right:0;display:flex;background:#fff}
.bottom button{flex:1}
.msg{text-align:center;font-weight:700}
</style>
</head>
<body>

<!-- AUTH -->
<div class="wrap" id="auth">
<h1>ğŸ¶ ë‚˜ì˜ ê°•ì•„ì§€</h1>
<div class="panel">
<input id="jid" placeholder="ì•„ì´ë””"><br>
<input id="jpw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
<button class="primary" onclick="join()">íšŒì›ê°€ì…</button>
<hr>
<input id="lid" placeholder="ì•„ì´ë””"><br>
<input id="lpw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
<button class="primary" onclick="login()">ë¡œê·¸ì¸</button>
<p id="authMsg" class="msg"></p>
</div>
</div>

<!-- SLOT -->
<div class="wrap hidden" id="slot">
<h2>ğŸ• ê°•ì•„ì§€ ì„ íƒ</h2>
<div class="grid grid-3" id="slotList"></div>
<button class="primary" onclick="newDog()">â• ìƒˆ ê°•ì•„ì§€</button>
</div>

<!-- GAME -->
<div class="wrap hidden" id="game">
<div class="panel">
<div class="dog" id="dogEl">ğŸ•</div>
<p class="msg" id="msg"></p>

<div>ğŸ– ë°°ë¶€ë¦„<div class="bar"><i id="hunger"></i></div></div>
<div>ğŸ˜Š í–‰ë³µ<div class="bar"><i id="happy"></i></div></div>
<div>âš¡ ì—ë„ˆì§€<div class="bar"><i id="energy"></i></div></div>

<p class="msg">ğŸ’° <span id="money"></span> ì½”ì¸</p>

<div class="grid grid-3">
<button onclick="feed()">ğŸª ê°„ì‹ (20)</button>
<button onclick="play()">ğŸ¾ ë†€ê¸°</button>
<button onclick="sleepDog()">ğŸ› ì ìê¸°</button>
<button onclick="saveUser()">ğŸ’¾ ì €ì¥</button>
<button onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</div>
</div>
</div>

<script>
const $=e=>document.getElementById(e)
const clamp=v=>Math.max(0,Math.min(100,v))
let user=null,users=null,dog=null,timer=null

async function hash(t){
 const b=new TextEncoder().encode(t)
 const h=await crypto.subtle.digest('SHA-256',b)
 return [...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,'0')).join('')
}

async function join(){
 if(!jid.value||!jpw.value)return
 if(localStorage.getItem('u_'+jid.value))return
 localStorage.setItem('u_'+jid.value,JSON.stringify({pw:await hash(jpw.value),dogs:[]}))
 authMsg.textContent='ê°€ì… ì™„ë£Œ'
}

async function login(){
 const u=localStorage.getItem('u_'+lid.value)
 if(!u)return
 const o=JSON.parse(u)
 if(o.pw!==await hash(lpw.value))return
 user=lid.value;users=o
 auth.classList.add('hidden');slot.classList.remove('hidden')
 renderSlots()
}

function renderSlots(){
 slotList.innerHTML=''
 users.dogs.forEach((d,i)=>{
  slotList.innerHTML+=`
   <div class="panel">
    <div class="dog">${d.skin}</div>
    <button onclick="selectDog(${i})">ì„ íƒ</button>
   </div>`
 })
}

function newDog(){
 users.dogs.push({skin:'ğŸ•',hunger:40,happy:60,tired:30,money:100})
 saveUser();renderSlots()
}

function selectDog(i){
 dog=users.dogs[i]
 slot.classList.add('hidden')
 game.classList.remove('hidden')
 start()
}

function start(){
 render()
 clearInterval(timer)
 timer=setInterval(tick,1000)
}

function tick(){
 dog.hunger=clamp(dog.hunger+0.05)
 dog.happy=clamp(dog.happy-0.05)
 dog.tired=clamp(dog.tired+0.05)

 if(dog.hunger>=100||dog.happy<=0||dog.tired>=100){
  dog.money=Math.max(0,dog.money-20)
  msg.textContent='âš ï¸ ê´€ë¦¬ ì‹¤íŒ¨! -20ì½”ì¸'
 }
 render()
}

function feed(){
 if(dog.money<20){msg.textContent='ì½”ì¸ ë¶€ì¡±';return}
 dog.money-=20
 dog.hunger=clamp(dog.hunger-40)
 msg.textContent='ğŸª ëƒ ëƒ !'
}

function play(){
 dog.happy=clamp(dog.happy+25)
 dog.tired=clamp(dog.tired+10)
 dog.money+=10
 msg.textContent='ğŸ¾ ì‹ ë‚˜ê²Œ ë†€ì•˜ë‹¤!'
}

function sleepDog(){
 dog.tired=clamp(dog.tired-40)
 dog.hunger=clamp(dog.hunger+10)
 dog.money+=10
 msg.textContent='ğŸ› í‘¹ ì !'
}

function render(){
 money.textContent=dog.money
 dogEl.textContent=dog.skin
 setBar('hunger',100-dog.hunger)
 setBar('happy',dog.happy)
 setBar('energy',100-dog.tired)
}

function setBar(id,v){
 const e=$(id)
 e.style.width=v+'%'
 e.classList.toggle('danger',v<25)
}

function saveUser(){
 localStorage.setItem('u_'+user,JSON.stringify(users))
 msg.textContent='ğŸ’¾ ì €ì¥ ì™„ë£Œ!'
}

function logout(){
 saveUser()
 location.reload()
}
</script>
</body>
</html>
